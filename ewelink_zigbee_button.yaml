blueprint:
  name: EWELink Zigbee Button
  description: Setup actions for three functions of the EWELink Zigbee button with Press, Double Press, and Hold.
  domain: automation
  input:
    button_id:
      name: Button
      description: The button to configure.
      selector:
        device:
          filter:
          - manufacturer: eWeLink
            model: CK-TLSR8656-SS5-01(7000)
          - manufacturer: eWeLink
            model: ZM-SY101
          - manufacturer: eWeLink
            model: YWL02
          - manufacturer: eWeLink
            model: C3006-YWL02
          - manufacturer: eWeLink
            model: SNZB-01P
          multiple: false
    mode:
      name: Automation mode
      description: The automation's mode configuration option controls what happens when the automation is triggered while the actions are still running from a previous trigger.
      default: single
      selector:
        select:
          options:
            - single
            - restart
            - queued
            - parallel
    press_action:
      name: Press Action
      description: Action to perform on Press (toggle command).
      default: []
      selector:
        action: {}
    double_press_action:
      name: Double Press Action
      description: Action to perform on Double Press (on command).
      default: []
      selector:
        action: {}
    hold_action:
      name: Hold Action
      description: Action to perform on Hold (off command).
      default: []
      selector:
        action: {}
  source_url: https://github.com/AnkhMorpork78/blueprints/blob/main/ewelink_zigbee_button.yaml

variables:
  button_id: !input 'button_id'
  press_action: !input 'press_action'
  double_press_action: !input 'double_press_action'
  hold_action: !input 'hold_action'
  mode: !input 'mode'

mode: !input 'mode'
max_exceeded: silent

trigger:
  - platform: event
    event_type: zha_event
    event_data:
      device_id: !input 'button_id'
      command: "toggle"
  - platform: event
    event_type: zha_event
    event_data:
      device_id: !input 'button_id'
      command: "on"
  - platform: event
    event_type: zha_event
    event_data:
      device_id: !input 'button_id'
      command: "off"

action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.command == "toggle" }}'
      sequence: !input 'press_action'
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.command == "on" }}'
      sequence: !input 'double_press_action'
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.command == "off" }}'
      sequence: !input 'hold_action'
